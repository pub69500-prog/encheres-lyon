<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventes aux Ench√®res Lyon - Auto Update</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to bottom, #0d0d0d 0%, #1a1a1a 100%);
            color: #00ff41;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ff41;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41; }
            to { text-shadow: 0 0 20px #00ff41, 0 0 30px #00ff41, 0 0 40px #00ff41; }
        }

        .subtitle {
            text-align: center;
            color: #00cc33;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .loading {
            text-align: center;
            font-size: 1.5em;
            padding: 40px;
            color: #00cc33;
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            color: #ff4444;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .auction-card {
            background: rgba(0, 20, 0, 0.6);
            border: 1px solid #00cc33;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .auction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.4);
            border-color: #00ff41;
        }

        .auction-date {
            font-size: 1.4em;
            font-weight: bold;
            color: #00ff41;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #00cc33;
        }

        .auction-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #00cc33;
            border-radius: 4px;
        }

        .auction-title {
            font-size: 1.2em;
            color: #00ff41;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .auction-house {
            color: #00cc33;
            font-size: 1em;
            margin-bottom: 5px;
        }

        .auction-time {
            color: #009922;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .auction-location {
            color: #007711;
            font-size: 0.9em;
            font-style: italic;
        }

        .auction-link {
            display: inline-block;
            margin-top: 8px;
            color: #00ff41;
            text-decoration: none;
            border: 1px solid #00cc33;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .auction-link:hover {
            background: #00cc33;
            color: #000;
        }

        .last-update {
            text-align: center;
            color: #009922;
            margin-top: 30px;
            font-size: 0.9em;
            padding-top: 20px;
            border-top: 1px solid #00cc33;
        }

        .filter-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 30, 0, 0.5);
            border: 1px solid #00cc33;
            border-radius: 8px;
        }

        .filter-section input {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00cc33;
            color: #00ff41;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            width: 100%;
            font-size: 1em;
        }

        .filter-section input:focus {
            outline: none;
            border-color: #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
        }

        .no-results {
            text-align: center;
            color: #009922;
            padding: 40px;
            font-size: 1.2em;
        }

        .week-info {
            text-align: center;
            color: #00cc33;
            font-size: 1em;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0, 40, 0, 0.3);
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî® VENTES AUX ENCH√àRES LYON üî®</h1>
        <div class="subtitle">Mise √† jour automatique quotidienne</div>
        
        <div class="filter-section">
            <input type="text" id="searchInput" placeholder="Rechercher par maison, type de vente, date...">
        </div>

        <div class="week-info" id="weekInfo"></div>

        <div id="content">
            <div class="loading">‚è≥ Chargement des ventes aux ench√®res...</div>
        </div>

        <div class="last-update" id="lastUpdate"></div>
    </div>

    <script>
        // Fonction pour obtenir la semaine en cours
        function getCurrentWeekDates() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1));
            
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            return { monday, sunday };
        }

        // Fonction pour formater une date
        function formatDate(date) {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('fr-FR', options);
        }

        // Fonction pour filtrer les ventes de la semaine
        function filterCurrentWeekAuctions(auctions) {
            const { monday, sunday } = getCurrentWeekDates();
            
            return auctions.filter(auction => {
                const auctionDate = new Date(auction.date);
                return auctionDate >= monday && auctionDate <= sunday;
            });
        }

        // Fonction pour afficher l'info de la semaine
        function displayWeekInfo() {
            const { monday, sunday } = getCurrentWeekDates();
            const weekInfo = document.getElementById('weekInfo');
            weekInfo.textContent = `Semaine du ${monday.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' })} au ${sunday.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })}`;
        }

        // Fonction pour afficher les ventes
        function displayAuctions(auctions) {
            const content = document.getElementById('content');
            
            if (auctions.length === 0) {
                content.innerHTML = '<div class="no-results">Aucune vente aux ench√®res pr√©vue cette semaine √† Lyon</div>';
                return;
            }

            let html = '';
            auctions.forEach(day => {
                const searchableText = `${day.displayDate} ${day.auctions.map(a => a.title + ' ' + a.house).join(' ')}`.toLowerCase();
                
                html += `
                    <div class="auction-card" data-searchable="${searchableText}">
                        <div class="auction-date">üìÖ ${day.displayDate}</div>
                `;
                
                day.auctions.forEach(auction => {
                    html += `
                        <div class="auction-item">
                            <div class="auction-title">${auction.title}</div>
                            <div class="auction-house">üèõÔ∏è ${auction.house}</div>
                            <div class="auction-time">‚è∞ ${auction.time}</div>
                            <div class="auction-location">üìç ${auction.location}</div>
                            ${auction.url ? `<a href="${auction.url}" target="_blank" class="auction-link">üîó Plus d'infos</a>` : ''}
                        </div>
                    `;
                });
                
                html += '</div>';
            });

            content.innerHTML = html;
        }

        // Fonction de recherche
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const cards = document.querySelectorAll('.auction-card');
                
                cards.forEach(card => {
                    const searchableText = card.getAttribute('data-searchable');
                    if (searchableText.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }

        // Fonction pour mettre √† jour la date de derni√®re mise √† jour
        function updateLastUpdateTime(lastScraped) {
            const lastUpdate = document.getElementById('lastUpdate');
            if (lastScraped) {
                const date = new Date(lastScraped);
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                lastUpdate.textContent = `Derni√®re mise √† jour : ${date.toLocaleDateString('fr-FR', options)}`;
            } else {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                lastUpdate.textContent = `Page consult√©e le : ${now.toLocaleDateString('fr-FR', options)}`;
            }
        }

        // Fonction principale pour charger les donn√©es depuis le JSON
        async function loadAuctions() {
            try {
                // Charger les donn√©es depuis le fichier JSON
                const response = await fetch('./data/auctions.json');
                
                if (!response.ok) {
                    throw new Error('Impossible de charger les donn√©es');
                }
                
                const data = await response.json();
                
                // Filtrer les ventes de la semaine en cours
                const currentWeekAuctions = filterCurrentWeekAuctions(data.auctions);
                
                // Afficher l'info de la semaine
                displayWeekInfo();
                
                // Afficher les ventes
                displayAuctions(currentWeekAuctions);
                
                // Mettre √† jour la date
                updateLastUpdateTime(data.last_update);
                
                // Activer la recherche
                setupSearch();
                
            } catch (error) {
                const content = document.getElementById('content');
                content.innerHTML = `
                    <div class="error">
                        ‚ö†Ô∏è Erreur lors du chargement des ventes aux ench√®res. 
                        Les donn√©es n'ont pas pu √™tre r√©cup√©r√©es.
                    </div>
                `;
                console.error('Erreur:', error);
            }
        }

        // Charger les ventes au chargement de la page
        window.addEventListener('DOMContentLoaded', loadAuctions);
    </script>
</body>
</html>
