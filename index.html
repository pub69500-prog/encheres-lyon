<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ventes aux Ench√®res Lyon - Toutes Maisons & Dates</title>
    <style>
        /* ... styles existants ... */
        .refresh-btn {
            display:inline-block; background:#00ff41; color:#191a19; border:none; border-radius:6px; font-size:1em; font-weight:bold; padding:8px 18px; margin:5px 0 16px 0; cursor:pointer; box-shadow: 0 0 8px #00ff41;
            transition:background 0.2s;
        }
        .refresh-btn:hover { background:#00cc33; color:#fff;}
    </style>
</head>
<body>
    <div class="container">
        <h1>üî® VENTES AUX ENCH√àRES LYON üî®</h1>
        <div class="subtitle">Toutes les maisons, toutes les dates √† venir (scroll et recherche instantan√©s)</div>
        <button class="refresh-btn" id="refreshButton">‚ü≥ Actualiser la liste</button>
        <div class="filter-section">
            <input type="text" id="searchInput" placeholder="Recherche par date, maison, type, lieu...">
        </div>
        <div id="content"></div>
        <div class="last-update" id="lastUpdate"></div>
    </div>
    <script>
        function formatFrDate(dateIso) {
            try {
                const date = new Date(dateIso);
                return date.toLocaleDateString('fr-FR', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
            } catch { return dateIso; }
        }
        let auctionsAll = [];
        function displayAuctions(auctions) {
            const content = document.getElementById('content');
            if (auctions.length === 0) {
                content.innerHTML = '<div class="no-results">Aucune vente aux ench√®res trouv√©e</div>';return;
            }
            let html = '';
            auctions.forEach(day => {
                html += `<div class="auction-card" data-searchable="${day.displayDate.toLowerCase()} ${day.auctions.map(a => a.title + ' ' + a.house).join(' ').toLowerCase()}">
                            <div class="auction-date">üìÖ ${formatFrDate(day.date)}</div>`;
                day.auctions.forEach(auction => {
                    html += `<div class="auction-item">
                                <div class="auction-title">${auction.title}</div>
                                <div class="auction-house">üèõÔ∏è ${auction.house}</div>
                                <div class="auction-time">‚è∞ ${auction.time}</div>
                                <div class="auction-location">üìç ${auction.location}</div>
                                ${auction.url ? `<a href="${auction.url}" class="auction-link" target="_blank">üîó Info</a>` : ''}
                             </div>`;
                });
                html += '</div>';
            });
            content.innerHTML = html;
        }
        function setupSearch(auctions) {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                let filtered = [];
                if (searchTerm === "") filtered = auctions;
                else {
                    filtered = auctions.map(day => ({
                        ...day,
                        auctions: day.auctions.filter(auc => (
                            day.displayDate.toLowerCase().includes(searchTerm) ||
                            auc.title.toLowerCase().includes(searchTerm) ||
                            auc.house.toLowerCase().includes(searchTerm) ||
                            (auc.location && auc.location.toLowerCase().includes(searchTerm))
                        ))
                    })).filter(day => day.auctions.length > 0);
                }
                displayAuctions(filtered);
            });
        }
        function updateLastUpdateTime(lastScraped) {
            const lastUpdate = document.getElementById('lastUpdate');
            if (lastScraped) {
                const date = new Date(lastScraped);
                lastUpdate.textContent = `Derni√®re actualisation : ${date.toLocaleDateString('fr-FR', {weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}`;
            }
        }
        async function loadAuctions() {
            try {
                const response = await fetch('./data/auctions.json?' + Date.now());
                const data = await response.json();
                auctionsAll = data.auctions;
                displayAuctions(auctionsAll);
                setupSearch(auctionsAll);
                updateLastUpdateTime(data.last_update);
            } catch (e) {
                document.getElementById('content').innerHTML = '<div class="error">Erreur lors du chargement des ventes</div>';
            }
        }
        document.getElementById('refreshButton').addEventListener('click', function() {
            loadAuctions(); // recharge les donn√©es JSON et met la page √† jour
        });
        window.addEventListener('DOMContentLoaded', loadAuctions);
        // Scrolling naturel sur toute la page (javascript, recherche imm√©diate)
    </script>
</body>
</html>
