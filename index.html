<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ventes aux Ench√®res Lyon</title>
<style>
body {
  font-family: 'Courier New', Courier, monospace;
  background: #111316;
  color: #00ff41;
  margin: 0; padding: 0;
  transition: background 0.5s;
}
.container {
  max-width: 1040px;
  margin: 40px auto;
  background: rgba(0,0,0,0.94);
  border: 2px solid #00ff41;
  border-radius: 14px;
  box-shadow: 0 0 35px #008d35a6;
  padding: 32px 14px;
}
h1 {
  text-align:center;
  font-size:2.4em;
  letter-spacing:3px;
  margin-bottom:10px;
  text-shadow: 0 0 12px #00ff41, 0 0 8px #007c2b;
  animation:glow 4s ease-in-out infinite alternate;
}
@keyframes glow {
  from { text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41;}
  to { text-shadow:0 0 24px #00ff41,0 0 40px #84d39b, 0 0 10px #00ff41;}
}
.subtitle {
  text-align:center; color:#1de007; margin-bottom:22px; font-size:1.1em;
}
.refresh-btn {
  display:inline-block; background:#00ff41; color:#111316; border:none; border-radius:6px; font-size:1em; font-weight:bold; padding:8px 18px; margin:5px 0 16px 0; cursor:pointer; box-shadow: 0 0 12px #00ff41; transition:background 0.2s;
}
.refresh-btn:hover { background:#007c2b; color:#fff; }
.filter-section {margin-bottom:22px; padding:12px 0;}
.filter-section input {
  background:rgba(0,0,0,0.7);
  border:1px solid #00cc33;
  color:#00ff41;
  padding:10px;
  border-radius:5px;
  font-family:'Courier New',monospace;
  width:97%;
  font-size:1.09em;
  box-shadow:0 0 7px #007c2b36;
}
.filter-section input:focus {outline:none; border-color:#00ff41;}
.auction-card {
  background: rgba(0,20,0,0.51);
  border:1px solid #109c45;
  border-radius:9px;
  padding:15px;
  margin-bottom:14px;
  transition:all 0.3s;
  box-shadow:0 3px 18px rgba(0,255,65,0.13);
}
.auction-card:hover {transform:translateY(-2px); box-shadow:0 5px 26px rgba(11,255,65,0.13); border-color:#00ff41;}
.auction-date {
  font-size:1.26em;font-weight:bold;color:#00ff41;
  margin-bottom:8px; padding-bottom:6px;
  border-bottom:1px solid #007c2b;
  letter-spacing:1px;
}
.auction-item {
  background:rgba(0,0,0,0.24); padding:8px;
  margin:7px 0; border-left:3px solid #13ff47;
  border-radius:2px;
  box-shadow:0 0 4px #08ec33;
}
.auction-title{font-size:1.13em;color:#baffb2;margin-bottom:2px;font-weight:bold;letter-spacing:.5px;}
.auction-house{color:#00cc33;font-size:1em;}
.auction-time{color:#70d97e;font-size:0.98em;}
.auction-location{color:#37ce63;font-size:0.99em; font-style:italic;}
.auction-link{display:inline-block; margin-top:2px; margin-right:10px; color:#1bf07d; text-decoration:none;}
.auction-link:hover{color:#fff;background:#1de007;}
.last-update{text-align:center;color:#008d35;margin-top:22px;font-size:1em; opacity:.84; letter-spacing:.5px;}
.no-results{text-align:center;color:#219d58;padding:18px;font-size:1.13em;}
.error {text-align:center;color:#ff0000;padding:18px;font-size:1.13em;}
.loading {text-align:center;color:#00ff41;padding:18px;font-size:1.13em; animation: spin 1s linear infinite;}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
@media (max-width: 700px) {.container {padding:6px;} h1 {font-size:1.3em;} }
</style>
</head>
<body>
<div class="container">
    <h1>üî© VENTES AUX ENCH√àRES RH√îNE/LYON üî©</h1>
    <div class="subtitle">Maison De Baecque, Conan, Interencheres ‚Äì Recherche & Scroll illimit√©s</div>
    <button class="refresh-btn" id="refreshButton" aria-label="Actualiser la liste des ventes">‚ü≥ Actualiser la liste</button>
    <div class="filter-section">
        <label for="searchInput" class="sr-only">Recherche par date, maison, type, lieu...</label>
        <input type="text" id="searchInput" placeholder="Recherche par date, maison, type, lieu...">
    </div>
    <div id="content"></div>
    <div class="last-update" id="lastUpdate"></div>
</div>
<script>
function formatFrDate(dateIso) {
    try { return new Date(dateIso).toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long',year:'numeric'}); }
    catch { return dateIso; }
}
let auctionsAll = [];
let debounceTimer;
function displayAuctions(auctions) {
    const content = document.getElementById('content');
    if (!auctions || auctions.length === 0) {
        content.innerHTML = '<div class="no-results">Aucune vente aux ench√®res trouv√©e</div>';return;
    }
    let html = '';
    auctions.forEach(day => {
        html += `<div class="auction-card" data-searchable="${day.displayDate.toLowerCase()} ${day.auctions.map(a => a.title + ' ' + a.house).join(' ').toLowerCase()}">
            <div class="auction-date">üìÖ ${formatFrDate(day.date)}</div>`;
        day.auctions.forEach(auction => {
            html += `<div class="auction-item">
                <div class="auction-title">${auction.title}</div>
                <div class="auction-house">üèõÔ∏è ${auction.house}</div>
                <div class="auction-time">‚è∞ ${auction.time}</div>
                <div class="auction-location">üìç ${auction.location}</div>
                ${auction.url ? `<a href="${auction.url}" class="auction-link" target="_blank" rel="noopener noreferrer">üîó Catalogue</a>` : ''}
            </div>`;
        });
        html += '</div>';
    });
    content.innerHTML = html;
}
function setupSearch(auctions) {
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            const searchTerm = this.value.trim().toLowerCase();
            let filtered = [];
            if (searchTerm === "") filtered = auctions;
            else {
                filtered = auctions.map(day => ({
                    ...day,
                    auctions: day.auctions.filter(auc => (
                        day.displayDate.toLowerCase().includes(searchTerm) ||
                        auc.title.toLowerCase().includes(searchTerm) ||
                        auc.house.toLowerCase().includes(searchTerm) ||
                        (auc.location && auc.location.toLowerCase().includes(searchTerm))
                    ))
                })).filter(day => day.auctions.length > 0);
            }
            displayAuctions(filtered);
        }, 300); // Debounce de 300ms
    });
}
function updateLastUpdateTime(lastScraped) {
    const lastUpdate = document.getElementById('lastUpdate');
    if (lastScraped) {
        const date = new Date(lastScraped);
        lastUpdate.textContent = `Derni√®re actualisation : ${date.toLocaleDateString('fr-FR', {weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}`;
    }
}
async function loadAuctions() {
    const content = document.getElementById('content');
    content.innerHTML = '<div class="loading">Chargement... üîÑ</div>';
    try {
        const response = await fetch('./data/auctions.json?' + Date.now());
        if (!response.ok) throw new Error('Erreur r√©seau');
        const data = await response.json();
        auctionsAll = data.auctions;
        displayAuctions(auctionsAll);
        setupSearch(auctionsAll);
        updateLastUpdateTime(data.last_update);
    } catch (e) {
        content.innerHTML = '<div class="error">Erreur lors du chargement des ventes : ' + e.message + '</div>';
    }
}
document.getElementById('refreshButton').addEventListener('click', loadAuctions);
window.addEventListener('DOMContentLoaded', loadAuctions);
</script>
</body>
</html>
